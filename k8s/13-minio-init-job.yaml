apiVersion: batch/v1
kind: Job
metadata:
  name: minio-init
  namespace: splitttr
spec:
  backoffLimit: 6
  template:
    metadata:
      labels:
        app: minio-init
    spec:
      restartPolicy: OnFailure
      containers:
        - name: mc
          image: minio/mc:latest
          command: ["/bin/sh", "-c"]
          args:
            - |
              set -e
              until (/usr/bin/mc alias set local http://minio:9000 minio minio12345); do echo "waiting for minio" && sleep 2; done
              /usr/bin/mc mb -p local/drive-bucket || true
              /usr/bin/mc anonymous set public local/drive-bucket || true
              echo "minio bucket ready"
